<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle en Español</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-XXXXXXXXXX'); // Reemplaza 'G-XXXXXXXXXX' con tu ID de medición de Google Analytics
    </script>
    <style>
        /* Estilos generales */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif; /* Usando Inter como fuente */
            background-color: #121213;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh; /* Ocupa toda la altura de la ventana */
            padding: 10px; /* Reducir padding para más espacio */
            justify-content: space-between; /* Distribuye el espacio entre los elementos */
        }
        
        h1 {
            font-size: 2.2rem; /* Reducir tamaño del título */
            font-weight: bold;
            margin: 15px 0; /* Reducir margen */
            text-align: center;
            border-bottom: 1px solid #3a3a3c;
            padding-bottom: 8px;
            width: 100%;
            max-width: 450px; /* Reducir ancho máximo */
            border-radius: 8px; /* Bordes redondeados */
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px; /* Reducir espacio entre elementos */
            width: 100%;
            max-width: 450px; /* Reducir ancho máximo */
            flex-grow: 1; /* Permite que el contenedor crezca */
            justify-content: center; /* Centra el contenido verticalmente */
        }
        
        .board {
            display: grid;
            grid-template-rows: repeat(6, 1fr);
            gap: 4px; /* Reducir espacio entre filas */
            margin: 10px 0; /* Reducir margen */
        }
        
        .row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px; /* Reducir espacio entre celdas */
        }
        
        .cell {
            width: 55px; /* Reducir tamaño de la celda */
            height: 55px; /* Reducir tamaño de la celda */
            border: 2px solid #3a3a3c;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem; /* Reducir tamaño de fuente */
            font-weight: bold;
            text-transform: uppercase;
            background-color: #121213;
            color: white;
            transition: all 0.1s ease;
            border-radius: 4px; /* Bordes redondeados */
        }
        
        .cell:not(:empty) {
            border-color: #565758;
        }
        
        /* Animaciones */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes flip {
            0% { transform: rotateX(0); }
            50% { transform: rotateX(90deg); }
            100% { transform: rotateX(0); }
        }
        
        .message {
            height: 30px;
            font-size: 1.1rem; /* Reducir tamaño de fuente */
            text-align: center;
            margin: 5px 0; /* Reducir margen */
        }
        
        .keyboard {
            display: flex;
            flex-direction: column;
            gap: 6px; /* Reducir espacio entre filas del teclado */
            margin-top: 15px; /* Reducir margen superior */
            width: 100%;
            max-width: 450px; /* Ajustar ancho máximo */
            padding-bottom: 10px; /* Espacio inferior para el teclado */
        }
        
        .keyboard-row {
            display: flex;
            justify-content: center;
            gap: 4px; /* Reducir espacio entre teclas */
        }
        
        .key {
            min-width: 38px; /* Reducir ancho mínimo de la tecla */
            height: 50px; /* Reducir altura de la tecla */
            border: none;
            border-radius: 4px;
            background-color: #818384;
            color: white;
            font-size: 13px; /* Reducir tamaño de fuente */
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            transition: background-color 0.1s ease;
            user-select: none;
        }
        
        .key:hover {
            background-color: #9ca3a4;
        }
        
        .key:active {
            transform: scale(0.95);
        }
        
        .key.wide {
            min-width: 60px; /* Reducir ancho de teclas anchas */
            font-size: 11px; /* Reducir tamaño de fuente */
        }
        
        /* Colores de las teclas según el estado */
        .key.correct {
            background-color: #6aaa64;
        }
        
        .key.present {
            background-color: #c9b458;
        }
        
        .key.absent {
            background-color: #3a3a3c;
        }
        
        .key.correct:hover {
            background-color: #5a9a54;
        }
        
        .key.present:hover {
            background-color: #b9a448;
        }
        
        .key.absent:hover {
            background-color: #2a2a2c;
        }

        /* Estilos para el modal */
        .modal {
            display: none; /* Oculto por defecto */
            position: fixed; /* Posición fija en la pantalla */
            z-index: 1; /* Por encima de otros elementos */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Permite scroll si el contenido es muy grande */
            background-color: rgba(0,0,0,0.7); /* Fondo oscuro semitransparente */
            justify-content: center;
            align-items: center;
            border-radius: 8px;
        }

        .modal-content {
            background-color: #2a2a2c;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            text-align: center;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: #fff;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>WORDLE</h1>
    
    <div class="game-container">
        <div class="board" id="board">
            </div>
        
        <div class="message" id="message"></div>
        
        <div class="keyboard" id="keyboard">
            <div class="keyboard-row">
                <button class="key" data-key="q">Q</button>
                <button class="key" data-key="w">W</button>
                <button class="key" data-key="e">E</button>
                <button class="key" data-key="r">R</button>
                <button class="key" data-key="t">T</button>
                <button class="key" data-key="y">Y</button>
                <button class="key" data-key="u">U</button>
                <button class="key" data-key="i">I</button>
                <button class="key" data-key="o">O</button>
                <button class="key" data-key="p">P</button>
            </div>
            <div class="keyboard-row">
                <button class="key" data-key="a">A</button>
                <button class="key" data-key="s">S</button>
                <button class="key" data-key="d">D</button>
                <button class="key" data-key="f">F</button>
                <button class="key" data-key="g">G</button>
                <button class="key" data-key="h">H</button>
                <button class="key" data-key="j">J</button>
                <button class="key" data-key="k">K</button>
                <button class="key" data-key="l">L</button>
                <button class="key" data-key="ñ">Ñ</button>
            </div>
            <div class="keyboard-row">
                <button class="key wide" data-key="enter">ENTER</button>
                <button class="key" data-key="z">Z</button>
                <button class="key" data-key="x">X</button>
                <button class="key" data-key="c">C</button>
                <button class="key" data-key="v">V</button>
                <button class="key" data-key="b">B</button>
                <button class="key" data-key="n">N</button>
                <button class="key" data-key="m">M</button>
                <button class="key wide" data-key="backspace">⌫</button>
            </div>
        </div>
    </div>

    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modalMessage"></p>
        </div>
    </div>

    <script>
        // Banco de palabras en español de 5 letras
        const PALABRAS_POSIBLES = [
            'ABETO', 'ABONO', 'ABRIL', 'ACEITE', 'ACTOR', 'ADIOS', 'AFORO', 'AGAVE', 'AGUJA', 'AHORA',
            'AJENO', 'ALAMO', 'ALBUM', 'ALFIL', 'ALGAS', 'ALIEN', 'ALTAR', 'AMADO', 'AMAGO', 'AMBOS',
            'AMPLI', 'ANCLA', 'ANGEL', 'ANIMO', 'ANTRO', 'APODO', 'ARENA', 'ARIDO', 'ARNES', 'ASADO',
            'ATLAS', 'AUDIO', 'AVENA', 'AVION', 'AYUDA', 'AZTEC', 'BAILE', 'BANDA', 'BARON', 'BARCO',
            'BATON', 'BELLO', 'BINGO', 'BLUSA', 'BOMBA', 'BORDE', 'BRAVO', 'BROTE', 'BUENO', 'BUSCA',
            'CABAL', 'CABRE', 'CACAO', 'CADIZ', 'CAIDA', 'CALMA', 'CAMPO', 'CAOBA', 'CARGA', 'CARNE',
            'CARTA', 'CAUCE', 'CAUSE', 'CEBRA', 'CERCO', 'CHICA', 'CHINO', 'CIELO', 'CINCO', 'CINTA',
            'CIRCO', 'CLARO', 'COSTA', 'CREMA', 'CUEVA', 'CURSO', 'DANZA', 'DATOS', 'DEJAR', 'DESEO',
            'DIETA', 'DIGNO', 'DISCO', 'DOLOR', 'DONAR', 'DRAMA', 'DUCHA', 'DULCE', 'EBANO', 'EDWIN',
            'ELENA', 'ENERO', 'ENTRE', 'EPOCA', 'ERROR', 'ETICA', 'ETNIA', 'EURO', 'EXTRA', 'FALDA',
            'FANGO', 'FECHA', 'FELIZ', 'FERIA', 'FIBRA', 'FINCA', 'FLACO', 'FLAMA', 'FLORA', 'FORMA',
            'FRASE', 'FRENO', 'FRUTO', 'FUEGO', 'FUERA', 'FURIA', 'GANAR', 'GATOS', 'GENIO', 'GENTE',
            'GIRAR', 'GLOBO', 'GORRA', 'GRADO', 'GRANO', 'GRAPA', 'GRASA', 'GRAVE', 'GRIPE', 'GRUPO',
            'GUANO', 'GUAPO', 'GUION', 'GUSANO', 'HABER', 'HABLA', 'HACIA', 'HAITI', 'HARTA', 'HASTA',
            'HELIO', 'HIELO', 'HIERRO', 'HIMNO', 'HOGAR', 'HONGO', 'HONOR', 'HOTEL', 'HUCHA', 'HUESO',
            'HUMOR', 'IDEAL', 'IGUAL', 'INDIA', 'INDIO', 'INGLES', 'INTRO', 'JABON', 'JAMON', 'JARDIN',
            'JOVEN', 'JUEGO', 'JUNTO', 'KIWIS', 'LAVAR', 'LEMON', 'LETRA', 'LIBRE', 'LIBRO', 'LINEA',
            'LISTA', 'LLAMA', 'LLANO', 'LLUVIA', 'LOBO', 'LOCAL', 'LOCO', 'LOGRO', 'LUCHA', 'LUGAR',
            'LUNAR', 'MADRE', 'MAGIA', 'MALTA', 'MANDO', 'MANGO', 'MANOS', 'MAPLE', 'MARCA', 'MARZO',
            'MASA', 'MAYOR', 'MELON', 'MENOR', 'MESA', 'METRO', 'MICRO', 'MIEL', 'MIRAR', 'MIXED',
            'MODAL', 'MORAL', 'MORIR', 'MOVER', 'MUCHO', 'MUNDO', 'MUSGO', 'NACER', 'NADA', 'NEGRO',
            'NIEVE', 'NIVEL', 'NOBLE', 'NOCHE', 'NORTE', 'NOVIA', 'NUBE', 'NUEVO', 'NUNCA', 'OCASO',
            'OCEAN', 'ODIAR', 'OESTE', 'OPERA', 'ORDEN', 'OREJA', 'OSITO', 'OTROS', 'OVALO', 'PADRE',
            'PAGAR', 'PAGINA', 'PALMA', 'PANDA', 'PANEL', 'PAPEL', 'PARIS', 'PARTE', 'PASAR', 'PASTA',
            'PATATA', 'PATIO', 'PAUSA', 'PEACE', 'PECHO', 'PEDIR', 'PELEA', 'PELLA', 'PERRO', 'PIANO',
            'PICAR', 'PIEZA', 'PINTA', 'PIZZA', 'PLANO', 'PLATA', 'PLAYA', 'PLAZA', 'PLUMA', 'PODER',
            'POEMA', 'POETA', 'POKER', 'POLO', 'PONTE', 'PRECIO', 'PRIMA', 'PRIMO', 'PROFE', 'PUNTO',
            'QUESO', 'QUIEN', 'QUITO', 'RADIO', 'RAMAT', 'RANGO', 'RAPOR', 'RATIO', 'RATON', 'RAZON',
            'REINA', 'REINO', 'RELOJ', 'RESTO', 'RIFLE', 'RITMO', 'ROBLE', 'ROBOT', 'RONDA', 'ROSAS',
            'RUGBY', 'RUIDO', 'SABER', 'SABOR', 'SALON', 'SALUD', 'SANTA', 'SANTO', 'SAXO', 'SECAR',
            'SEGUN', 'SELVA', 'SEÑOR', 'SERIE', 'SIGLO', 'SILLA', 'SOBRE', 'SODA', 'SOFIA', 'SOLAR',
            'SOLO', 'SONGE', 'SONIA', 'SUPER', 'TABLE', 'TACTO', 'TANGO', 'TANTO', 'TARDE', 'TECLA',
            'TENIS', 'TERRA', 'TEXTO', 'TIEMPO', 'TIGER', 'TINTA', 'TIPO', 'TITAN', 'TIZÓN', 'TODAS',
            'TOKYO', 'TOMAR', 'TOQUE', 'TORRE', 'TOTAL', 'TOTEM', 'TRAGO', 'TRATO', 'TRECE', 'TRIGO',
            'TRINO', 'TRONO', 'TUBER', 'TUMOR', 'ULTRA', 'UNION', 'URBAN', 'USUAL', 'VACIO', 'VALER',
            'VALLE', 'VALOR', 'VAPOR', 'VECES', 'VENDA', 'VERDE', 'VIDEO', 'VIEJO', 'VILLA', 'VIRUS',
            'VISTA', 'VIVIR', 'VOCAL', 'VODKA', 'VOLAR', 'WALES', 'WHALE', 'WORLD', 'YACHT', 'YOGA',
            'ZEBRA', 'ZORRO'
        ];
        
        // Variables del juego
        let currentRow = 0;
        let currentCol = 0;
        let currentGuess = '';
        let targetWord = '';
        let gameOver = false;
        let keyboardState = {}; // Para rastrear el estado de las teclas

        // Variables para el límite diario de palabras
        const MAX_GAMES_PER_DAY = 2;
        let gamesPlayedToday = 0;
        let lastPlayedDate = '';

        // Función para obtener la fecha actual en formato YYYY-MM-DD
        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // Meses son 0-11
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Función para cargar el estado del juego desde localStorage
        function loadGameState() {
            const storedDate = localStorage.getItem('lastPlayedDate');
            const storedGames = parseInt(localStorage.getItem('gamesPlayedToday') || '0', 10);
            const today = getTodayDate();

            if (storedDate === today) {
                lastPlayedDate = storedDate;
                gamesPlayedToday = storedGames;
            } else {
                // Si es un nuevo día, resetear el contador de juegos
                lastPlayedDate = today;
                gamesPlayedToday = 0;
                saveGameState(); // Guardar el nuevo estado
                // Enviar evento a Google Analytics: Reinicio diario
                if (typeof gtag === 'function') {
                    gtag('event', 'game_reset', {
                        'event_category': 'game_status',
                        'event_label': 'daily_reset'
                    });
                }
            }
        }

        // Función para guardar el estado del juego en localStorage
        function saveGameState() {
            localStorage.setItem('lastPlayedDate', lastPlayedDate);
            localStorage.setItem('gamesPlayedToday', gamesPlayedToday);
        }

        // Función para mostrar un modal personalizado
        function showModal(message) {
            const modal = document.getElementById('myModal');
            const modalMessage = document.getElementById('modalMessage');
            modalMessage.textContent = message;
            modal.style.display = 'flex'; // Mostrar el modal
            // Enviar evento a Google Analytics: Modal mostrado
            if (typeof gtag === 'function') {
                gtag('event', 'modal_view', {
                    'event_category': 'ui_interaction',
                    'event_label': message
                });
            }
        }

        // Función para cerrar el modal
        function closeModal() {
            const modal = document.getElementById('myModal');
            modal.style.display = 'none'; // Ocultar el modal
            // Enviar evento a Google Analytics: Modal cerrado
            if (typeof gtag === 'function') {
                gtag('event', 'modal_close', {
                    'event_category': 'ui_interaction',
                    'event_label': 'modal_closed'
                });
            }
        }

        // Seleccionar palabra aleatoria al iniciar
        function selectRandomWord() {
            const randomIndex = Math.floor(Math.random() * PALABRAS_POSIBLES.length);
            targetWord = PALABRAS_POSIBLES[randomIndex];
            // console.log('Palabra secreta:', targetWord); // Para debugging (quitar en producción)
        }
        
        // Verificar si una palabra existe en el diccionario
        function isValidWord(word) {
            return PALABRAS_POSIBLES.includes(word.toUpperCase());
        }
        
        // Inicializar el tablero
        function initBoard() {
            const board = document.getElementById('board');
            board.innerHTML = ''; // Limpiar el tablero antes de inicializar

            for (let i = 0; i < 6; i++) {
                const row = document.createElement('div');
                row.className = 'row';
                row.id = `row-${i}`;
                
                for (let j = 0; j < 5; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${i}-${j}`;
                    row.appendChild(cell);
                }
                
                board.appendChild(row);
            }
        }
        
        // Función para agregar una letra al tablero
        function addLetter(letter) {
            if (gameOver || gamesPlayedToday >= MAX_GAMES_PER_DAY) return; // No permitir jugar si el límite se ha alcanzado

            if (currentCol < 5) {
                const cell = document.getElementById(`cell-${currentRow}-${currentCol}`);
                cell.textContent = letter.toUpperCase();
                currentGuess += letter.toUpperCase();
                currentCol++;
                
                // Agregar animación de escritura
                cell.style.animation = 'pop 0.1s ease-in-out';
                setTimeout(() => {
                    cell.style.animation = '';
                }, 100);

                // Enviar evento a Google Analytics: Tecla presionada
                if (typeof gtag === 'function') {
                    gtag('event', 'key_press', {
                        'event_category': 'game_interaction',
                        'event_label': 'letter_typed',
                        'key': letter.toUpperCase()
                    });
                }
            }
        }
        
        // Función para eliminar una letra
        function deleteLetter() {
            if (gameOver || gamesPlayedToday >= MAX_GAMES_PER_DAY) return; // No permitir jugar si el límite se ha alcanzado

            if (currentCol > 0) {
                currentCol--;
                const cell = document.getElementById(`cell-${currentRow}-${currentCol}`);
                cell.textContent = '';
                currentGuess = currentGuess.slice(0, -1);
                // Enviar evento a Google Analytics: Tecla Backspace presionada
                if (typeof gtag === 'function') {
                    gtag('event', 'key_press', {
                        'event_category': 'game_interaction',
                        'event_label': 'backspace_pressed'
                    });
                }
            }
        }
        
        // Función para evaluar la palabra y colorear las celdas
        function evaluateGuess() {
            const guess = currentGuess;
            const target = targetWord;
            const result = [];
            
            // Crear array para marcar letras ya utilizadas
            const targetLetters = target.split('');
            const usedPositions = new Array(5).fill(false);
            
            // Primera pasada: marcar letras correctas (verdes)
            for (let i = 0; i < 5; i++) {
                if (guess[i] === target[i]) {
                    result[i] = 'correct';
                    usedPositions[i] = true;
                }
            }
            
            // Segunda pasada: marcar letras en posición incorrecta (amarillas) y incorrectas (grises)
            for (let i = 0; i < 5; i++) {
                if (result[i] !== 'correct') {
                    let found = false;
                    for (let j = 0; j < 5; j++) {
                        if (!usedPositions[j] && guess[i] === target[j] && result[j] !== 'correct') {
                            result[i] = 'present';
                            usedPositions[j] = true;
                            found = true;
                            break;
                        }
                    }
                    if (!found) {
                        result[i] = 'absent';
                    }
                }
            }
            
            return result;
        }
        
        // Función para actualizar el estado del teclado visual
        function updateKeyboardState(letter, state) {
            const currentState = keyboardState[letter];
            
            // Solo actualizar si el nuevo estado es "mejor" que el actual
            if (!currentState || 
                (currentState === 'absent' && (state === 'present' || state === 'correct')) ||
                (currentState === 'present' && state === 'correct')) {
                keyboardState[letter] = state;
                
                // Actualizar visualmente la tecla
                const keyElement = document.querySelector(`[data-key="${letter.toLowerCase()}"]`);
                if (keyElement) {
                    keyElement.classList.remove('correct', 'present', 'absent');
                    keyElement.classList.add(state);
                }
            }
        }
        
        // Función para colorear las celdas según el resultado
        function colorCells(result) {
            for (let i = 0; i < 5; i++) {
                const cell = document.getElementById(`cell-${currentRow}-${i}`);
                
                setTimeout(() => {
                    cell.style.animation = 'flip 0.6s ease-in-out';
                    
                    setTimeout(() => {
                        if (result[i] === 'correct') {
                            cell.style.backgroundColor = '#6aaa64'; // Verde
                            cell.style.borderColor = '#6aaa64';
                        } else if (result[i] === 'present') {
                            cell.style.backgroundColor = '#c9b458'; // Amarillo  
                            cell.style.borderColor = '#c9b458';
                        } else {
                            cell.style.backgroundColor = '#787c7e'; // Gris
                            cell.style.borderColor = '#787c7e';
                        }
                        cell.style.color = 'white';
                        
                        // Actualizar el estado del teclado
                        const letter = currentGuess[i];
                        updateKeyboardState(letter, result[i]);
                    }, 300);
                }, i * 100);
            }
        }
        
        // Función para procesar Enter
        function submitGuess() {
            if (gameOver) return;
            if (gamesPlayedToday >= MAX_GAMES_PER_DAY) {
                showModal(`Has alcanzado el límite de ${MAX_GAMES_PER_DAY} palabras por día. Vuelve mañana.`);
                return;
            }
            
            if (currentGuess.length === 5) {
                if (isValidWord(currentGuess)) {
                    const result = evaluateGuess();
                    colorCells(result);
                    
                    // Enviar evento a Google Analytics: Intento de palabra válido
                    if (typeof gtag === 'function') {
                        gtag('event', 'word_guess', {
                            'event_category': 'game_interaction',
                            'event_label': 'valid_guess',
                            'word': currentGuess.toUpperCase(),
                            'row': currentRow + 1,
                            'result': result.join(',')
                        });
                    }

                    // Verificar si ganó
                    if (currentGuess === targetWord) {
                        setTimeout(() => {
                            showModal(`¡Felicidades! La palabra era ${targetWord}`);
                            gameOver = true;
                            gamesPlayedToday++;
                            saveGameState();
                            // Enviar evento a Google Analytics: Juego ganado
                            if (typeof gtag === 'function') {
                                gtag('event', 'game_end', {
                                    'event_category': 'game_status',
                                    'event_label': 'won',
                                    'attempts': currentRow + 1,
                                    'word': targetWord
                                });
                            }
                        }, 2000);
                    } 
                    // Verificar si perdió
                    else if (currentRow === 5) {
                        setTimeout(() => {
                            showModal(`Game Over. La palabra era: ${targetWord}`);
                            gameOver = true;
                            gamesPlayedToday++;
                            saveGameState();
                            // Enviar evento a Google Analytics: Juego perdido
                            if (typeof gtag === 'function') {
                                gtag('event', 'game_end', {
                                    'event_category': 'game_status',
                                    'event_label': 'lost',
                                    'attempts': currentRow + 1,
                                    'word': targetWord
                                });
                            }
                        }, 2000);
                    }
                    
                    // Preparar siguiente intento
                    currentRow++;
                    currentCol = 0;
                    currentGuess = '';
                } else {
                    showMessage('Palabra no válida');
                    // Enviar evento a Google Analytics: Intento de palabra inválido
                    if (typeof gtag === 'function') {
                        gtag('event', 'word_guess', {
                            'event_category': 'game_interaction',
                            'event_label': 'invalid_guess',
                            'word': currentGuess.toUpperCase()
                        });
                    }
                }
            } else {
                showMessage('La palabra debe tener 5 letras');
            }
        }
        
        // Función para mostrar mensajes temporales en el div de mensajes
        function showMessage(text) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            setTimeout(() => {
                if (!gameOver) {
                    messageEl.textContent = '';
                }
            }, 2000);
        }
        
        // Función para manejar clics en el teclado virtual
        function handleKeyboardClick(key) {
            if (key === 'enter') {
                submitGuess();
            } else if (key === 'backspace') {
                deleteLetter();
            } else if (key >= 'a' && key <= 'z' || key === 'ñ') {
                addLetter(key);
            }
            // Enviar evento a Google Analytics: Clic en tecla virtual
            if (typeof gtag === 'function') {
                gtag('event', 'virtual_key_click', {
                    'event_category': 'game_interaction',
                    'event_label': key.toUpperCase()
                });
            }
        }
        
        // Capturar teclas del teclado físico
        document.addEventListener('keydown', function(event) {
            const key = event.key.toLowerCase();
            
            // Prevenir comportamiento por defecto para teclas especiales
            if (key === 'backspace' || key === 'enter') {
                event.preventDefault();
            }
            
            // Solo permitir letras del alfabeto español
            if ((key >= 'a' && key <= 'z' || key === 'ñ') && key.length === 1) {
                addLetter(key);
            }
            // Tecla Backspace para borrar
            else if (key === 'backspace') {
                deleteLetter();
            }
            // Tecla Enter para enviar
            else if (key === 'enter') {
                submitGuess();
            }
            // Enviar evento a Google Analytics: Tecla física presionada
            if (typeof gtag === 'function') {
                gtag('event', 'physical_key_press', {
                    'event_category': 'game_interaction',
                    'event_label': key.toUpperCase()
                });
            }
        });
        
        // Agregar event listeners al teclado virtual
        function initKeyboard() {
            const keys = document.querySelectorAll('.key');
            keys.forEach(key => {
                key.addEventListener('click', () => {
                    const keyValue = key.getAttribute('data-key');
                    handleKeyboardClick(keyValue);
                });
            });
        }
        
        // Inicializar el juego cuando se carga la página
        document.addEventListener('DOMContentLoaded', function() {
            loadGameState(); // Cargar el estado del juego al inicio
            initBoard();
            initKeyboard();
            
            if (gamesPlayedToday >= MAX_GAMES_PER_DAY) {
                showModal(`Has alcanzado el límite de ${MAX_GAMES_PER_DAY} palabras por día. Vuelve mañana.`);
                gameOver = true; // Deshabilitar el juego si el límite se ha alcanzado
            } else {
                selectRandomWord();
                showMessage('¡Adivina la palabra de 5 letras!');
                // Enviar evento a Google Analytics: Juego iniciado
                if (typeof gtag === 'function') {
                    gtag('event', 'game_start', {
                        'event_category': 'game_status',
                        'event_label': 'new_game'
                    });
                }
            }

            // Configurar el botón de cierre del modal
            document.querySelector('.close-button').addEventListener('click', closeModal);
            window.addEventListener('click', (event) => {
                const modal = document.getElementById('myModal');
                if (event.target === modal) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>
